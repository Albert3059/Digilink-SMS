(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10965,e=>{"use strict";var t=e.i(75305);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)(({color:e="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:n,className:l="",children:o,iconNode:d,...c},u)=>(0,t.createElement)("svg",{ref:u,...s,width:i,height:i,stroke:e,strokeWidth:n?24*Number(a)/Number(i):a,className:r("lucide",l),...c},[...d.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(o)?o:[o]])),a=(e,s)=>{let a=(0,t.forwardRef)(({className:a,...n},l)=>(0,t.createElement)(i,{ref:l,iconNode:s,className:r(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,a),...n}));return a.displayName=`${e}`,a};e.s(["default",()=>a],10965)},94179,e=>{"use strict";var t=e.i(1972),r=e.i(42937),s=e.i(94237),i=e.i(47163);let a=(0,s.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:s,asChild:n=!1,...l}){let o=n?r.Slot:"span";return(0,t.jsx)(o,{"data-slot":"badge",className:(0,i.cn)(a({variant:s}),e),...l})}e.s(["Badge",()=>n])},38634,e=>{"use strict";var t=e.i(1972),r=e.i(20755),s=e.i(75305),i=e.i(30499),a=e.i(31208),n=e.i(94179),l=e.i(67881),o=e.i(47163);function d({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,o.cn)("w-full caption-bottom text-sm",e),...r})})}function c({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,o.cn)("[&_tr]:border-b",e),...r})}function u({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,o.cn)("[&_tr:last-child]:border-0",e),...r})}function m({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,o.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function h({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,o.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function x({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,o.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}var p=e.i(2854);let g=["bg-blue-50","bg-green-50","bg-purple-50","bg-yellow-50","bg-pink-50","bg-indigo-50","bg-teal-50","bg-orange-50"];function b({subscriptions:e}){let a=(0,i.useRouter)(),[o,b]=(0,s.useState)(null),f=e=>new Date(e).toLocaleDateString(),v=async e=>{if(!confirm("Are you sure you want to delete this subscription?"))return;b(e);let t=(0,r.createClient)();try{let{error:r}=await t.from("subscriptions").delete().eq("id",e);if(r)throw r;a.refresh()}catch(e){alert("Failed to delete subscription"),b(null)}};return 0===e.length?(0,t.jsxs)("div",{className:"text-center py-12 border border-border rounded-lg bg-accent/50",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No subscriptions found"}),(0,t.jsx)(p.default,{href:"/subscriptions/new",children:(0,t.jsx)(l.Button,{children:"Create your first subscription"})})]}):(0,t.jsx)("div",{className:"border border-border rounded-lg overflow-hidden",children:(0,t.jsxs)(d,{children:[(0,t.jsx)(c,{children:(0,t.jsxs)(m,{className:"bg-muted",children:[(0,t.jsx)(h,{children:"Client"}),(0,t.jsx)(h,{children:"Type"}),(0,t.jsx)(h,{children:"Start Date"}),(0,t.jsx)(h,{children:"End Date"}),(0,t.jsx)(h,{children:"Status"}),(0,t.jsx)(h,{children:"Price"}),(0,t.jsx)(h,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(u,{children:e.map((e,r)=>{let s,i,a;return(0,t.jsxs)(m,{className:`${g[r%g.length]} hover:opacity-75 transition-opacity`,children:[(0,t.jsx)(x,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.client_name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.client_email})]})}),(0,t.jsx)(x,{className:"text-sm",children:e.subscription_type}),(0,t.jsx)(x,{className:"text-sm",children:f(e.start_date)}),(0,t.jsxs)(x,{className:"text-sm",children:[f(e.end_date),(s=new Date(e.end_date),i=new Date,(a=Math.ceil((s.getTime()-i.getTime())/864e5))<=30&&a>0&&(0,t.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"Expiring soon"}))]}),(0,t.jsx)(x,{children:(0,t.jsx)(n.Badge,{className:(e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"expired":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,t.jsx)(x,{className:"text-sm",children:e.price?`$${e.price.toFixed(2)}`:"-"}),(0,t.jsx)(x,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(p.default,{href:`/subscriptions/${e.id}/edit`,children:(0,t.jsx)(l.Button,{variant:"outline",size:"sm",children:"Edit"})}),(0,t.jsx)(l.Button,{variant:"destructive",size:"sm",onClick:()=>v(e.id),disabled:o===e.id,children:o===e.id?"Deleting...":"Delete"})]})})]},e.id)})})]})})}var f=e.i(10965);let v=(0,f.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function j({subscriptions:e}){return(0,t.jsxs)(l.Button,{variant:"outline",onClick:()=>{if(!e||0===e.length)return void alert("No subscriptions to export");let t=new Blob([["Client Name,Client Email,Subscription Type,Status,Start Date,End Date,Renewal Date,Price,Notes",...e.map(e=>[e.client_name||"",e.client_email||"",e.subscription_type||"",e.status||"",e.start_date||"",e.end_date||"",e.renewal_date||"",e.price||"",e.notes||""]).map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),s=URL.createObjectURL(t);r.setAttribute("href",s),r.setAttribute("download",`subscriptions-${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},children:[(0,t.jsx)(v,{className:"w-4 h-4 mr-2"}),"Export CSV"]})}let y=(0,f.default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);function w({subscriptions:e=[],adminEmail:r,companyName:i}){let[a,n]=(0,s.useState)(!1),o=async()=>{try{n(!0),console.log("[v0] Sending report with",e.length,"subscriptions");let t=await fetch("/api/reports/send-subscription-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptions:e||[],adminEmail:r||"admin@digilink.com",companyName:i||"Digilink IT Subscription Management System"})}),s=await t.json();if(console.log("[v0] Report response:",s),!t.ok)throw Error(s.error||"Failed to send report");alert(s.message||"Report sent successfully!")}catch(e){console.error("[v0] Error sending report:",e.message),alert(`Failed to send report: ${e.message||"Please try again."}`)}finally{n(!1)}};return(0,t.jsxs)(l.Button,{variant:"outline",onClick:o,disabled:a||0===e.length,children:[(0,t.jsx)(y,{className:"w-4 h-4 mr-2"}),a?"Sending...":"Email Report"]})}function N(){let e=(0,i.useRouter)(),n=(0,i.useSearchParams)().get("filter"),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[x,g]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{!async function(){let t=(0,r.createClient)(),{data:{user:s}}=await t.auth.getUser();if(!s)return e.push("/auth/login");h(s);let{data:i}=await t.from("admins").select("*").eq("id",s.id).single();u(i);let a=t.from("subscriptions").select("*").eq("admin_id",s.id).order("end_date",{ascending:!0});if("active"===n)a=a.eq("status","active");else if("expired"===n)a=a.eq("status","expired");else if("expiring"===n){let e=new Date().toISOString(),t=new Date;t.setDate(t.getDate()+30),a=a.eq("status","active").gte("end_date",e).lte("end_date",t.toISOString())}let{data:l}=await a;d(l||[]),g(!1)}()},[n,e]),x)?(0,t.jsx)("div",{className:"min-h-svh bg-background flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading subscriptions..."})}):(0,t.jsxs)("div",{className:"min-h-svh bg-background",children:[(0,t.jsx)(a.default,{admin:c,user:m}),(0,t.jsxs)("main",{className:"container py-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Subscriptions"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage all your client subscriptions"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(j,{subscriptions:o}),(0,t.jsx)(w,{subscriptions:o,adminEmail:c?.report_email||m?.email||"",companyName:c?.company_name}),(0,t.jsx)(p.default,{href:"/subscriptions/new",children:(0,t.jsx)(l.Button,{children:"Add Subscription"})})]})]}),(0,t.jsx)(b,{subscriptions:o})]})]})}e.s(["default",()=>N],38634)}]);